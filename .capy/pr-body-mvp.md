MVP: Gmail → Google Calendar automation

Summary
- End-to-end Gmail→Calendar MVP using Next.js 15, NextAuth (Google OAuth), Prisma + Vercel Postgres, Vercel Cron, and Vercel AI SDK tool-calling.
- Auto-creates primary calendar events from relevant Gmail threads and surfaces them in a dashboard.

Key changes
- Authentication (NextAuth): Google OAuth with Gmail Readonly + Calendar scopes, offline access enabled (access_type=offline, prompt=consent). Database sessions via Prisma adapter. Session callback exposes user.id.
- Token security: AES‑256‑GCM encryption for Account.access_token and refresh_token via Prisma middleware. ENCRYPTION_KEY required.
- Database: Added NextAuth tables and app models (EmailThread, CalendarEvent, UserSyncState) with idempotency constraints and indexes.
- LLM relevance + tool-calling: Vercel AI SDK (gpt-4o-mini by default) exposes `create_calendar_event` tool. Model abstains if not confident/no datetime. Token usage aggregated per cron run.
- Gmail polling (cron): Scheduled function at /api/cron/gmail runs every 5 minutes (vercel.json). For each connected user, fetches today’s Inbox threads (in user’s Google Calendar timezone), runs LLM classification, creates events on primary calendar, stores results, and marks threads processed. Safety cap of 50 threads/user/run.
- Time parsing: If tool omits end time, fallback to chrono-node; defaults to 30 minutes.
- Frontend: Landing page with Google sign-in and a simple dashboard listing created events with Calendar + Gmail links.

Configuration
- Requires env: NEXTAUTH_URL, NEXTAUTH_SECRET, GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, DATABASE_URL, ENCRYPTION_KEY (32 bytes base64/hex), CRON_SECRET, OPENAI_API_KEY, AI_MODEL (optional; default gpt-4o-mini).
- API routes run with Node runtime.

Idempotency & safety
- Unique (userId, gmailThreadId) enforced; reruns skip already-created events.
- Per-run safety cap and minimal error handling to isolate per-user failures.

Acceptance criteria mapping
- Google sign-in with DB persistence ✓
- Encrypted refresh tokens with offline access and token refresh ✓
- Cron scheduled every 5 minutes, secured by header ✓
- Only today’s Inbox threads per user timezone ✓
- LLM classification with create_calendar_event tool and auto-create on primary calendar ✓
- Dashboard lists generated events with links and thread refs ✓
- Idempotent processing and token usage logging ✓

Follow-ups
- Add structured logs/metrics and retry/backoff for API quota errors.
- Add pagination/filters to dashboard and show times in user timezone.
- Optional user controls for inclusion/exclusion rules and duration defaults.


₍ᐢ•(ܫ)•ᐢ₎ Generated by [Capy](https://capy.ai) ([view task](https://capy.ai/project/8de8e7da-044b-4a12-bdc6-4ad5e6c38bc8/task/ff5c899d-caeb-4536-b63a-a24a94feb8fd))